<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Stopwatch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        
        
        :root {
            --primary: #3b82f6;
            --text: #1e293b;
            --bg: #f8fafc;
            --panel: #ffffff;
            --lap-bg: #f1f5f9;
        }

        .dark-mode {
            --primary: #60a5fa;
            --text: #e2e8f0;
            --bg: #0f172a;
            --panel: #1e293b;
            --lap-bg: #334155;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            transition: all 0.3s ease;
        }

        .floating {
            position: fixed;
            bottom: 20px;
            right: 20px;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        .floating .display {
            font-size: 1.5rem;
        }

        .floating .controls {
            display: none;
        }

        @media (max-width: 640px) {
            .display {
                font-size: 4rem !important;
            }
        }

        .vibrate {
            animation: vibrate 0.1s linear;
        }

        @keyframes vibrate {
            0% { transform: scale(1); }
            50% { transform: scale(0.98); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .lap-item {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
        }

        .dark-mode .lap-item {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .lap-item:nth-child(odd) {
            background-color: var(--lap-bg);
        }

        .minimal-mode .controls {
            display: none;
        }

        .minimal-mode .display {
            font-size: 6rem !important;
        }

        body.minimal-mode {
            background-color: var(--panel);
        }

        /* Block font styling for numbers */
        .display {
            font-family: 'Courier New', monospace;
            font-weight: 900;
            font-size: 5rem;
            letter-spacing: 0.1em;
        }

    </style>
    
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">
    <div class="w-full max-w-3xl bg-[var(--panel)] rounded-xl shadow-lg p-6 transition-all duration-300" id="stopwatch-container">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold">Advanced Stopwatch</h1>
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-[var(--lap-bg)] transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" id="theme-icon">
                    <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>

        <div class="flex flex-col items-center">
            <div class="text-center mb-10">
                <div class="display text-8xl md:text-9xl font-black" id="display">00:00:00</div>
                <div class="flex justify-center text-xs text-gray-500 dark:text-gray-400">
                    <span class="w-16">second</span>
                    <span class="w-16">minute</span>
                    <span class="w-16">hour</span>
                </div>
            </div>
            <div class="flex justify-center gap-6 mb-8" id="controls">
                <button id="start-btn" class="px-8 py-4 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-xl font-bold">
                    Start
                </button>
                <button id="stop-btn" class="px-8 py-4 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-xl font-bold" disabled>
                    Stop
                </button>
                <button id="reset-btn" class="px-8 py-4 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-xl font-bold">
                    Reset
                </button>
            </div>
        </div>
    </div>

    <!-- Floating stopwatch (initially hidden) -->
    <div id="floating-watch" class="floating hidden w-32 h-32 bg-[var(--panel)] rounded-full flex flex-col items-center justify-center">
        <div class="text-center">
            <div class="display text-sm font-mono" id="floating-display">00:00:00</div>
            <div class="text-[0.5rem] text-gray-500 dark:text-gray-400">
                <span>s</span>&nbsp;<span>m</span>&nbsp;<span>h</span>
            </div>
        </div>
    </div>

    <script>
        // Audio context for sound feedback
        let audioCtx;
        try {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        } catch (e) {
            console.log('Audio context not supported');
        }
        
        // DOM Elements
        const display = document.getElementById('display');
        const floatingDisplay = document.getElementById('floating-display');
        const startBtn = document.getElementById('start-btn');
        const stopBtn = document.getElementById('stop-btn');
        const resetBtn = document.getElementById('reset-btn');
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const stopwatchContainer = document.getElementById('stopwatch-container');
        const floatingWatch = document.getElementById('floating-watch');

        // State variables
        let startTime = 0;
        let elapsedTime = 0;
        let timerInterval;
        let isRunning = false;
        let isDark = false;

        // Format time as SS:MM:HH (second:minute:hour)
        function formatTime(timeInMillis) {
            const hours = Math.floor(timeInMillis / 3600000).toString().padStart(2, '0');
            const minutes = Math.floor((timeInMillis % 3600000) / 60000).toString().padStart(2, '0');
            const seconds = Math.floor((timeInMillis % 60000) / 1000).toString().padStart(2, '0');
            return `${seconds}:${minutes}:${hours}`;
        }

        // Update the display
        function updateDisplay() {
            const currentTime = Date.now() - startTime + elapsedTime;
            const formattedTime = formatTime(currentTime);
            
            display.textContent = formattedTime;
            floatingDisplay.textContent = formattedTime;
        }

        // Start the stopwatch
        function start() {
            if (!isRunning) {
                startTime = Date.now();
                timerInterval = setInterval(updateDisplay, 10);
                isRunning = true;
                startBtn.disabled = true;
                stopBtn.disabled = false;
                playSound(440, 0.05, 'sine');
                document.body.classList.add('pulse');
                if (navigator.vibrate) navigator.vibrate(50);
            }
        }

        // Stop the stopwatch
        function stop() {
            if (isRunning) {
                clearInterval(timerInterval);
                elapsedTime += Date.now() - startTime;
                isRunning = false;
                startBtn.disabled = false;
                stopBtn.disabled = true;
                playSound(220, 0.05, 'sine');
                document.body.classList.remove('pulse');
                if (navigator.vibrate) navigator.vibrate(100);
            }
        }

        // Reset the stopwatch
        function reset() {
            clearInterval(timerInterval);
            startTime = 0;
            elapsedTime = 0;
            isRunning = false;
            display.textContent = '00:00:00';
            floatingDisplay.textContent = '00:00:00';
            startBtn.disabled = false;
            stopBtn.disabled = true;
            document.body.classList.remove('pulse');
            playSound(330, 0.1, 'square');
            if (navigator.vibrate) navigator.vibrate([50, 50, 50]);
        }

        // Toggle dark/light mode - FIXED
        function toggleTheme() {
            isDark = !isDark;
            
            if (isDark) {
                document.body.classList.add('dark-mode');
                themeIcon.innerHTML = '<path fill-rule="evenodd" d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" clip-rule="evenodd" />';
            } else {
                document.body.classList.remove('dark-mode');
                themeIcon.innerHTML = '<path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd" />';
            }
            
            if (navigator.vibrate) navigator.vibrate(10);
        }

        // Play sound feedback
        function playSound(freq, vol, type) {
            if (!audioCtx) return;
            
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            
            try {
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                
                oscillator.type = type;
                oscillator.frequency.value = freq;
                gainNode.gain.value = vol;
                
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                
                oscillator.start();
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.2);
                oscillator.stop(audioCtx.currentTime + 0.2);
            } catch (e) {
                console.log('Sound playback failed');
            }
        }

        // Event listeners
        startBtn.addEventListener('click', start);
        stopBtn.addEventListener('click', stop);
        resetBtn.addEventListener('click', reset);
        themeToggle.addEventListener('click', toggleTheme);

        // Make floating stopwatch draggable
        let isDragging = false;
        
        floatingWatch.addEventListener('mousedown', function(e) {
            e.preventDefault();
            isDragging = true;
            
            let shiftX = e.clientX - floatingWatch.getBoundingClientRect().left;
            let shiftY = e.clientY - floatingWatch.getBoundingClientRect().top;
            
            function moveAt(pageX, pageY) {
                floatingWatch.style.left = `${pageX - shiftX}px`;
                floatingWatch.style.top = `${pageY - shiftY}px`;
                floatingWatch.style.bottom = 'auto';
                floatingWatch.style.right = 'auto';
            }
            
            function onMouseMove(e) {
                if (isDragging) {
                    moveAt(e.pageX, e.pageY);
                }
            }
            
            document.addEventListener('mousemove', onMouseMove);
            
            document.addEventListener('mouseup', function() {
                isDragging = false;
                document.removeEventListener('mousemove', onMouseMove);
            });
        });
        
        floatingWatch.addEventListener('dblclick', function() {
            if (floatingWatch.classList.contains('w-32')) {
                floatingWatch.classList.remove('w-32', 'h-32');
                floatingWatch.classList.add('w-40', 'h-40');
                floatingWatch.querySelector('.display').classList.add('text-lg');
            } else {
                floatingWatch.classList.add('w-32', 'h-32');
                floatingWatch.classList.remove('w-40', 'h-40');
                floatingWatch.querySelector('.display').classList.remove('text-lg');
            }
        });

        // Initialize
        reset();
    </script>
</body>
</html>
